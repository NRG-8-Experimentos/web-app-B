<div class="analytics-member-screen">

  <!-- Resumen General -->
  <div class="section-card enhanced-section metric-enhanced">
    <div class="metric-icon-title">
      <span class="metric-icon material-icons info">info</span>
      <div class="metric-title-label-col">
        <div class="metric-title">{{ 'analyticsMember.overview.title' | translate }}</div>
        <div class="metric-label">{{ 'analyticsMember.overview.label' | translate }}</div>
      </div>
    </div>
    <div class="metrics-row">
      <div class="stat-card green">
        <div class="stat-value">{{ overview.completed ?? 0 }}</div>
        <div class="stat-label">{{ 'analyticsMember.overview.metrics.completed' | translate }}</div>
      </div>
      <div class="stat-card teal">
        <div class="stat-value">{{ overview.done ?? 0 }}</div>
        <div class="stat-label">{{ 'analyticsMember.overview.metrics.done' | translate }}</div>
      </div>
      <div class="stat-card blue">
        <div class="stat-value">{{ overview.inProgress ?? 0 }}</div>
        <div class="stat-label">{{ 'analyticsMember.overview.metrics.inProgress' | translate }}</div>
      </div>
      <div class="stat-card orange">
        <div class="stat-value">{{ overview.pending ?? 0 }}</div>
        <div class="stat-label">{{ 'analyticsMember.overview.metrics.pending' | translate }}</div>
      </div>
      <div class="stat-card red">
        <div class="stat-value">{{ overview.overdue ?? 0 }}</div>
        <div class="stat-label">{{ 'analyticsMember.overview.metrics.overdue' | translate }}</div>
      </div>
    </div>
    <hr class="section-divider">
    <div class="member-card member-row">
      <div class="profile-image avatar">
        <img *ngIf="member?.imgUrl; else defaultAvatar" [src]="member?.imgUrl" alt="Avatar" />
        <ng-template #defaultAvatar>
          <span class="default-avatar">&#128100;</span>
        </ng-template>
      </div>
      <span class="member-name">{{ member?.name }} {{ member?.surname }}</span>
      <span class="member-username">{{ member?.username }}</span>
      <span class="member-email">{{ member?.email }}</span>
    </div>
  </div>

  <!-- Distribución de Tareas -->
  <div class="section-card enhanced-section metric-enhanced">
    <div class="metric-icon-title">
      <span class="metric-icon material-icons list_alt">list_alt</span>
      <div class="metric-title-label-col">
        <div class="metric-title">{{ 'analyticsMember.taskDistribution.title' | translate }}</div>
        <div class="metric-label">{{ 'analyticsMember.taskDistribution.label' | translate }}</div>
      </div>
    </div>
    <div *ngIf="loadingTasks" class="loading-tasks">
      <span class="material-icons spin">autorenew</span>
    </div>
    <div *ngIf="!loadingTasks && (memberTasks?.length ?? 0) === 0" class="empty-section">
      {{ 'analyticsMember.taskDistribution.noTasks' | translate }}
    </div>
    <div *ngIf="!loadingTasks && (memberTasks?.length ?? 0) > 0">
      <div class="bar-chart-row">
        <span class="bar-chart-label">{{ 'analyticsMember.taskDistribution.total' | translate }}</span>
        <div class="bar-chart-bar-bg">
          <div class="bar-chart-bar-fg" [ngStyle]="{'width': '100%'}"></div>
        </div>
        <span class="bar-chart-value badge" style="white-space:nowrap;">
          {{ memberTasks.length }} {{ memberTasks.length === 1 ? ('analyticsMember.taskDistribution.task' | translate) : ('analyticsMember.taskDistribution.tasks' | translate) }}        </span>
      </div>
      <ul class="tasks-list">
        <li *ngFor="let task of memberTasks; let i = index">
          <span class="task-index">{{ i + 1 }}.</span>
          <span class="task-title">{{ task?.title }}</span>
        </li>
      </ul>
    </div>
  </div>

  <!-- Cantidad total de reprogramaciones -->
  <div class="section-card enhanced-section metric-enhanced">
    <div class="metric-icon-title">
      <span class="metric-icon material-icons build">build</span>
      <div class="metric-title-label-col">
        <div class="metric-title">{{ 'analyticsMember.rescheduled.title' | translate }}</div>
        <div class="metric-label">{{ 'analyticsMember.rescheduled.label' | translate }}</div>
      </div>
      <div class="metric-value-box">
        <span class="metric-value">
          {{ rescheduled?.rescheduled ?? 0 }}
        </span>
        <span class="metric-unit">
          {{ (rescheduled?.rescheduled ?? 0) === 1 ? ('analyticsMember.rescheduled.task' | translate) : ('analyticsMember.rescheduled.tasks' | translate) }}
        </span>
      </div>
    </div>
  </div>

  <!-- Tiempo Promedio de Finalización -->
  <div class="section-card enhanced-section metric-enhanced">
    <div class="metric-icon-title">
      <span class="metric-icon material-icons date_range">date_range</span>
      <div class="metric-title-label-col">
        <div class="metric-title">{{ 'analyticsMember.avgCompletion.title' | translate }}</div>
        <div class="metric-label">{{ 'analyticsMember.avgCompletion.label' | translate }}</div>
      </div>
      <div class="metric-value-box">
        <span class="metric-icon material-icons timer">timer</span>
        <span class="metric-value">
          {{ formatAvgCompletionTime(avgCompletion?.avgDays ?? 0) }}
        </span>
      </div>
    </div>
  </div>

  <!-- Tiempo de Tareas en Progreso -->
  <div class="section-card enhanced-section metric-enhanced">
    <div class="metric-icon-title">
      <span class="metric-icon material-icons hourglass_top">hourglass_top</span>
      <div class="metric-title-label-col">
        <div class="metric-title">{{ 'analyticsMember.inProgress.title' | translate }}</div>
        <div class="metric-label">{{ 'analyticsMember.inProgress.label' | translate }}</div>
      </div>
    </div>
    <div *ngIf="inProgressTaskDurations.length === 0" class="empty-section">
      {{ 'analyticsMember.inProgress.noTasks' | translate }}
    </div>
    <ul *ngIf="inProgressTaskDurations.length > 0" class="tasks-list progress-list">
      <li *ngFor="let t of inProgressTaskDurations" class="progress-row">
        <span class="progress-task-title">
          <span class="material-icons progress-task-icon">assignment</span>
          {{ t.title }}
        </span>
        <span class="progress-task-duration">
          {{ formatInProgressDuration(t.duration) }}
        </span>
      </li>
    </ul>
    <div class="progress-total-row">
      <span class="material-icons schedule">schedule</span>
      <span class="progress-total-label">{{ 'analyticsMember.inProgress.total' | translate }}</span>
      <span class="progress-total-value">
        {{ formatInProgressDuration(totalInProgressDuration) }}
      </span>
    </div>
  </div>

  <!-- Kanban Board Section -->
  <div class="section-card enhanced-section metric-enhanced">
    <div class="metric-icon-title">
      <span class="metric-icon material-icons view_kanban">view_kanban</span>
      <div class="metric-title-label-col">
        <div class="metric-title">{{ 'analyticsMember.kanban.title' | translate }}</div>
        <div class="metric-label">{{ 'analyticsMember.kanban.label' | translate }}</div>
      </div>
    </div>
    <app-kanban-board
      [tasks]="kanbanTasks"
      [loading]="loadingTasks"
      [translationPrefix]="'analyticsMember'">
    </app-kanban-board>
  </div>
</div>

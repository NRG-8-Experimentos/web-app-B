<div class="analytics-leader-screen">

  <!-- Resumen General -->
  <div class="section-card enhanced-section metric-enhanced">
    <div class="metric-icon-title">
      <span class="metric-icon material-icons info">info</span>
      <div class="metric-title-label-col">
        <div class="metric-title">{{ 'analyticsLeader.overview.title' | translate }}</div>
        <div class="metric-label">{{ 'analyticsLeader.overview.label' | translate }}</div>
      </div>
    </div>
    <div class="metrics-row">
      <div class="stat-card green">
        <div class="stat-value">{{ analytics.overview.completed ?? 0 }}</div>
        <div class="stat-label">{{ 'analyticsLeader.overview.metrics.completed' | translate }}</div>
      </div>
      <div class="stat-card teal">
        <div class="stat-value">{{ analytics.overview.done ?? 0 }}</div>
        <div class="stat-label">{{ 'analyticsLeader.overview.metrics.done' | translate }}</div>
      </div>
      <div class="stat-card blue">
        <div class="stat-value">{{ analytics.overview.inProgress ?? 0 }}</div>
        <div class="stat-label">{{ 'analyticsLeader.overview.metrics.inProgress' | translate }}</div>
      </div>
      <div class="stat-card orange">
        <div class="stat-value">{{ analytics.overview.pending ?? 0 }}</div>
        <div class="stat-label">{{ 'analyticsLeader.overview.metrics.pending' | translate }}</div>
      </div>
      <div class="stat-card red">
        <div class="stat-value">{{ analytics.overview.overdue ?? 0 }}</div>
        <div class="stat-label">{{ 'analyticsLeader.overview.metrics.overdue' | translate }}</div>
      </div>
    </div>
    <hr class="section-divider">
    <div class="members-list">
      <span class="members-title">{{ 'analyticsLeader.overview.allMembers' | translate }}</span>
      <div *ngFor="let member of safeMembers" class="member-row">
        <img *ngIf="member.imgUrl" [src]="member.imgUrl" class="profile-image">
        <span class="member-name">{{ member.name }} {{ member.surname }}</span>
      </div>
    </div>
  </div>

  <!-- Distribución de Tareas -->
  <div class="section-card enhanced-section metric-enhanced">
    <div class="metric-icon-title">
      <span class="metric-icon material-icons list_alt">list_alt</span>
      <div class="metric-title-label-col">
        <div class="metric-title">{{ 'analyticsLeader.taskDistribution.title' | translate }}</div>
        <div class="metric-label">{{ 'analyticsLeader.taskDistribution.label' | translate }}</div>
      </div>
    </div>
    <div *ngIf="!analytics.leaderTasks.length" class="empty-section">
      <span>{{ 'analyticsLeader.taskDistribution.noTasks' | translate }}</span>
    </div>
    <div *ngIf="analytics.leaderTasks.length">
      <div class="bar-chart-row" *ngFor="let task of analytics.leaderTasks">
        <img *ngIf="task.imgUrl" [src]="task.imgUrl" class="profile-image">
        <span class="bar-chart-label">{{ task.memberName }}</span>
        <div class="bar-chart-bar-bg">
          <div
            class="bar-chart-bar-fg"
            [ngStyle]="{'width': ((task.taskCount || 1) * 100 / getMaxTaskCount(analytics.leaderTasks)) + '%'}"
          ></div>
        </div>
        <span class="bar-chart-value badge" style="white-space:nowrap;">
          {{ task.taskCount }} {{ task.taskCount === 1 ? ('analyticsLeader.taskDistribution.task' | translate) : ('analyticsLeader.taskDistribution.tasks' | translate) }}
        </span>
      </div>
    </div>
  </div>

  <!-- Tareas Reprogramadas -->
  <div class="section-card enhanced-section metric-enhanced">
    <div class="metric-icon-title">
      <span class="metric-icon material-icons build">build</span>
      <div class="metric-title-label-col">
        <div class="metric-title">{{ 'analyticsLeader.rescheduled.title' | translate }}</div>
        <div class="metric-label">{{ 'analyticsLeader.rescheduled.label' | translate }}</div>
      </div>
      <div class="metric-value-box">
        <span class="metric-value">
          {{ analytics.rescheduled?.rescheduled ?? 0 }}
        </span>
        <span class="metric-unit">
          {{ (analytics.rescheduled?.rescheduled ?? 0) === 1 ? ('analyticsLeader.rescheduled.task' | translate) : ('analyticsLeader.rescheduled.tasks' | translate) }}
        </span>
      </div>
    </div>
    <hr class="section-divider">
    <div class="members-list">
      <span class="members-title">{{ 'analyticsLeader.rescheduled.membersTitle' | translate }}</span>
      <div *ngIf="membersWithRescheduled.length > 0">
        <div class="bar-chart-row" *ngFor="let member of membersWithRescheduled">
          <img *ngIf="member.imgUrl" [src]="member.imgUrl" class="profile-image">
          <span class="bar-chart-label">{{ member.name }} {{ member.surname }}</span>
          <div class="bar-chart-bar-bg">
            <div
              class="bar-chart-bar-fg"
              [ngStyle]="{'width': ((member.rescheduledCount || 1) * 100 / getMaxTaskCount(membersWithRescheduled)) + '%'}"
            ></div>
          </div>
          <span class="bar-chart-value badge" style="white-space:nowrap;">
            {{ member.rescheduledCount }} {{ member.rescheduledCount === 1 ? ('analyticsLeader.rescheduled.task' | translate) : ('analyticsLeader.rescheduled.tasks' | translate) }}
          </span>
        </div>
      </div>
      <div *ngIf="!membersWithRescheduled.length" class="empty-section">
        <span>{{ 'analyticsLeader.rescheduled.noMembers' | translate }}</span>
      </div>
    </div>
  </div>

  <!-- Tiempo Promedio de Finalización -->
  <div class="section-card enhanced-section metric-enhanced">
    <div class="metric-icon-title">
      <span class="metric-icon material-icons date_range">date_range</span>
      <div class="metric-title-label-col">
        <div class="metric-title">{{ 'analyticsLeader.avgCompletion.title' | translate }}</div>
        <div class="metric-label">{{ 'analyticsLeader.avgCompletion.label' | translate }}</div>
      </div>
      <div class="metric-value-box">
        <span class="metric-icon material-icons timer">timer</span>
      </div>
    </div>
    <div *ngIf="avgCompletionMembers.length > 0">
      <div *ngFor="let member of avgCompletionMembers" class="member-row two-col-member-row">
        <div class="member-info">
          <img *ngIf="member.imgUrl" [src]="member.imgUrl" class="profile-image">
          <span class="member-name">{{ member.name }} {{ member.surname }}</span>
        </div>
        <div class="member-value">
          <span class="metric-value badge member-metric-value">
            {{ formatMinutesToDuration(member.avgMinutes) }}
          </span>
        </div>
      </div>
    </div>
    <div *ngIf="!avgCompletionMembers.length" class="empty-section">
      <div class="member-row two-col-member-row">
        <div class="member-info">
          <span class="member-name">{{ 'analyticsLeader.avgCompletion.noTime' | translate }}</span>
        </div>
        <div class="member-value">
          <span class="metric-value badge member-metric-value"></span>
        </div>
      </div>
    </div>
  </div>

  <!-- Tiempo de Tareas en Progreso -->
  <div class="section-card enhanced-section metric-enhanced">
    <div class="metric-icon-title">
      <span class="metric-icon material-icons hourglass_top">hourglass_top</span>
      <div class="metric-title-label-col">
        <div class="metric-title">{{ 'analyticsLeader.inProgress.title' | translate }}</div>
        <div class="metric-label">{{ 'analyticsLeader.inProgress.label' | translate }}</div>
      </div>
    </div>
    <div *ngIf="inProgressDurationsMembers.length === 0" class="empty-section">
      <div class="member-row two-col-member-row">
        <div class="member-info">
          <span class="member-name">{{ 'analyticsLeader.inProgress.noTime' | translate }}</span>
        </div>
        <div class="member-value">
          <span class="progress-task-duration"></span>
        </div>
      </div>
    </div>
    <ul *ngIf="inProgressDurationsMembers.length > 0" class="tasks-list progress-list">
      <li *ngFor="let m of inProgressDurationsMembers" class="member-row two-col-member-row">
        <div class="member-info">
          <img *ngIf="m.imgUrl" [src]="m.imgUrl" class="profile-image progress-profile-image">
          <span class="member-name">{{ m.name }} {{ m.surname }}</span>
        </div>
        <div class="member-value">
          <span class="progress-task-duration">
            {{ formatInProgressDuration(m.totalInProgress) }}
          </span>
        </div>
      </li>
    </ul>
  </div>

  <!-- Kanban Board Section -->
  <div class="section-card enhanced-section metric-enhanced">
    <div class="metric-icon-title">
      <span class="metric-icon material-icons view_kanban">view_kanban</span>
      <div class="metric-title-label-col">
        <div class="metric-title">{{ 'analyticsLeader.kanban.title' | translate }}</div>
        <div class="metric-label">{{ 'analyticsLeader.kanban.label' | translate }}</div>
      </div>
    </div>
    <app-kanban-board
      [tasks]="kanbanTasks"
      [loading]="loadingTasks"
      [translationPrefix]="'analyticsLeader'">
    </app-kanban-board>
  </div>
</div>
